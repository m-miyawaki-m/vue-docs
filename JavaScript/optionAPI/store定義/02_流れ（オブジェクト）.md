ã¯ã„ã€å…ˆã»ã©ã®ã‚ˆã†ãª `operation â†’ plan â†’ measure` ã®**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆéšå±¤æ§‹é€ ã‚’Vuexã§ç®¡ç†ã™ã‚‹æµã‚Œ**ã‚’ã€`state â†’ getter â†’ mutation â†’ action` ã«æ²¿ã£ã¦å…·ä½“ä¾‹ä»˜ãã§è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ—‚ï¸ æƒ³å®šã™ã‚‹çŠ¶æ…‹æ§‹é€ ï¼ˆoperationDataï¼‰

```ts
[
  {
    operationId: 'OP001',
    plans: [
      {
        planId: 'PL001',
        measures: [
          { measureId: 'MS001' },
          { measureId: 'MS002' }
        ]
      }
    ]
  }
]
```

---

## âœ… 1. `state`: æ“ä½œå¯¾è±¡ã¨ãªã‚‹ãƒã‚¹ãƒˆæ§‹é€ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿æŒ

```ts
// store/modules/operation.ts
state: {
  operations: [] as Operation[]  // åˆæœŸå€¤ã¯ç©ºã®ãƒªã‚¹ãƒˆ
}
```

### ğŸ”¸å‹å®šç¾©ï¼ˆtypes.tsï¼‰

```ts
export interface Measure {
  measureId: string;
}
export interface Plan {
  planId: string;
  measures: Measure[];
}
export interface Operation {
  operationId: string;
  plans: Plan[];
}
```

---

## âœ… 2. `getter`: éšå±¤æ§‹é€ ã‹ã‚‰ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹

```ts
getters: {
  getOperationById: (state) => (id: string) => {
    return state.operations.find(op => op.operationId === id);
  },
  getPlansByOperationId: (state) => (id: string) => {
    return state.operations.find(op => op.operationId === id)?.plans || [];
  },
  getMeasuresByPlanId: (state) => (operationId: string, planId: string) => {
    return (
      state.operations
        .find(op => op.operationId === operationId)
        ?.plans.find(pl => pl.planId === planId)?.measures || []
    );
  }
}
```

---

## âœ… 3. `mutation`: ãƒã‚¹ãƒˆæ§‹é€ ã«å¯¾ã—ã¦å®‰å…¨ã«çŠ¶æ…‹å¤‰æ›´ã‚’è¡Œã†

```ts
mutations: {
  setOperations(state, payload: Operation[]) {
    state.operations = payload;
  },
  addPlanToOperation(state, payload: { operationId: string; plan: Plan }) {
    const op = state.operations.find(op => op.operationId === payload.operationId);
    if (op) {
      op.plans.push(payload.plan);
    }
  },
  addMeasureToPlan(state, payload: { operationId: string; planId: string; measure: Measure }) {
    const plan = state.operations
      .find(op => op.operationId === payload.operationId)
      ?.plans.find(pl => pl.planId === payload.planId);
    if (plan) {
      plan.measures.push(payload.measure);
    }
  }
}
```

---

## âœ… 4. `action`: å¤–éƒ¨é€šä¿¡/APIãªã©ã‚’åŠ å‘³ã—ã¦ä¸Šè¨˜ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†

```ts
actions: {
  async fetchInitialOperations({ commit }) {
    // ã“ã“ã§ã¯ä»®ãƒ‡ãƒ¼ã‚¿ã€‚APIé€£æºãªã‚‰ await axios.get(...) ãªã©
    const mockData: Operation[] = [
      {
        operationId: 'OP001',
        plans: [
          {
            planId: 'PL001',
            measures: [{ measureId: 'MS001' }]
          }
        ]
      }
    ];
    commit('setOperations', mockData);
  },

  async addNewPlan({ commit }, payload: { operationId: string; plan: Plan }) {
    // å¿…è¦ãªã‚‰APIä¿å­˜ â†’ ãã®å¾Œmutation
    commit('addPlanToOperation', payload);
  }
}
```

---

## âœ… 5. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ä½¿ã„æ–¹ï¼ˆOption APIï¼‰

```ts
<script lang="ts">
import { defineComponent } from 'vue';
import { useStore } from 'vuex';
import { Operation, Plan, Measure } from '@/store/types';

export default defineComponent({
  name: 'OperationManager',
  data() {
    return {
      selectedOperationId: 'OP001',
      selectedPlanId: 'PL001'
    };
  },
  computed: {
    operations(): Operation[] {
      return this.$store.state.operation.operations;
    },
    currentPlans(): Plan[] {
      return this.$store.getters['operation/getPlansByOperationId'](this.selectedOperationId);
    },
    currentMeasures(): Measure[] {
      return this.$store.getters['operation/getMeasuresByPlanId'](this.selectedOperationId, this.selectedPlanId);
    }
  },
  methods: {
    addSamplePlan() {
      this.$store.dispatch('operation/addNewPlan', {
        operationId: 'OP001',
        plan: { planId: 'PL999', measures: [] }
      });
    }
  },
  mounted() {
    this.$store.dispatch('operation/fetchInitialOperations');
  }
});
</script>
```

---

## ğŸ” å…¨ä½“ã®æµã‚Œã¾ã¨ã‚ï¼ˆãƒã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç®¡ç†ï¼‰

```plaintext
1. state â†’ operations[] ã‚’ä¿æŒï¼ˆåˆæœŸçŠ¶æ…‹ã¯ç©ºï¼‰
2. action â†’ fetchInitialOperations ã§åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥
3. getter â†’ operationId, planId ã‚’æŒ‡å®šã—ã¦å¿…è¦ãªæƒ…å ±ã‚’æŠ½å‡º
4. mutation â†’ addPlan/addMeasure ã§ãƒã‚¹ãƒˆæ§‹é€ ã‚’å®‰å…¨ã«æ›´æ–°
5. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ â†’ computed + dispatch/commit ã§é€£æº
```

---

å¿…è¦ã«å¿œã˜ã¦ã€**ç·¨é›†ãƒ»å‰Šé™¤ãƒ»ä¸¦ã³é †å¤‰æ›´**ãªã©ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚è¿½åŠ ã§ãã¾ã™ã€‚
ã€Œç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã¨ã®é€£æºã€ã€Œç”»é¢UIè¨­è¨ˆã€ãªã©ã‚‚ç¶šã‘ã¦ã”ææ¡ˆå¯èƒ½ã§ã™ã€‚æ¬¡ã«çŸ¥ã‚ŠãŸã„éƒ¨åˆ†ã¯ã©ã“ã§ã™ã‹ï¼Ÿ

äº†è§£ã—ã¾ã—ãŸï¼
ã¤ã¾ã‚Šã€**Vuex ã«ä¿æŒã•ã‚Œã¦ã„ã‚‹ãƒã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€ä½œæˆ¦ID (`operationId`) ã¨è¨ˆç”»ID (`planId`) ã‚’ã‚‚ã¨ã«ã€ãã“ã«å±ã™ã‚‹ `measures[]`ï¼ˆå¯¾å‡¦æ¡ˆä¸€è¦§ï¼‰ã‚’å–å¾—ã—ãŸã„**ã¨ã„ã†è¦ä»¶ã§ã™ã­ã€‚

---

## âœ… å¿…è¦ãª getter ã ã‘ã§å®Œçµã§ãã¾ã™

### âœ… Getter ã®å®šç¾©ï¼ˆmodules/operation.tsï¼‰

```ts
getters: {
  getMeasuresByOperationAndPlan:
    (state) => (operationId: string, planId: string) => {
      const operation = state.operations.find(op => op.operationId === operationId);
      const plan = operation?.plans.find(pl => pl.planId === planId);
      return plan?.measures || [];
    }
}
```

---

## âœ… ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå´ã§ã®ä½¿ã„æ–¹ï¼ˆOption APIï¼‰

```ts
<script lang="ts">
import { defineComponent } from 'vue';
import { Measure } from '@/store/types'; // å¿…è¦ã«å¿œã˜ã¦

export default defineComponent({
  name: 'MeasureViewer',
  data() {
    return {
      selectedOperationId: 'OP001',
      selectedPlanId: 'PL001'
    };
  },
  computed: {
    measures(): Measure[] {
      return this.$store.getters['operation/getMeasuresByOperationAndPlan'](
        this.selectedOperationId,
        this.selectedPlanId
      );
    }
  }
});
</script>
```

---

## âœ… ã“ã‚Œã§å–å¾—ã§ãã‚‹å†…å®¹

ä¾‹ï¼š
`selectedOperationId = 'OP001'`, `selectedPlanId = 'PL001'` ã®ã¨ãã€ä»¥ä¸‹ãŒå–å¾—ã•ã‚Œã¾ã™ï¼š

```ts
[
  { measureId: 'MS001' },
  { measureId: 'MS002' }
]
```

---

### ğŸ¯ è£œè¶³

* ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒ Vuex å´ã§æ­£ã—ãä¿æŒã•ã‚Œã¦ã„ã‚Œã°ã€mutation/action ã¯ä¸è¦
* ãŸã ã€Œè¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã€ã‚’è¡Œã„ãŸã„å ´åˆã¯ mutation/action ã‚’è¿½åŠ ã™ã‚‹

---

å¿…è¦ã§ã‚ã‚Œã°ã€measure ã‚’é¸æŠãƒ»è¡¨ç¤ºã™ã‚‹ãŸã‚ã® `<v-select>` ã‚„ãƒªã‚¹ãƒˆè¡¨ç¤ºç”¨ã® Vuetify UI ä¾‹ã‚‚æä¾›å¯èƒ½ã§ã™ã€‚ã”å¸Œæœ›ã‚ã‚Šã¾ã™ã‹ï¼Ÿ

äº†è§£ã—ã¾ã—ãŸï¼
ã“ã“ã§ä½¿ç”¨ã—ãŸ **Vuex ã® Getter ã¨ Option API ã®æ–‡æ³•**ã‚’ä¸­å¿ƒã«ã€**æ§‹æ–‡ã®æ„å‘³ã¨ä½¿ã„æ–¹**ã‚’ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¾ã™ã€‚

---

## ğŸ¯ ç›®çš„ã®ãŠã•ã‚‰ã„

Vuex ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€

```ts
getMeasuresByOperationAndPlan(operationId, planId)
```

ã¨ã„ã†å½¢ã§ã€**éšå±¤æ§‹é€ ã®ä¸­ã‹ã‚‰å¯¾å‡¦æ¡ˆ `measures` ã‚’å–å¾—ã—ãŸã„**ã¨ã„ã†ç”¨é€”ã§ã™ã€‚

---

## âœ… Getter ã®æ§‹æ–‡è§£èª¬

```ts
getters: {
  getMeasuresByOperationAndPlan:
    (state) => (operationId: string, planId: string) => {
      const operation = state.operations.find(op => op.operationId === operationId);
      const plan = operation?.plans.find(pl => pl.planId === planId);
      return plan?.measures || [];
    }
}
```

### â¬‡ åˆ†è§£ã—ã¦è§£èª¬

| ãƒ‘ãƒ¼ãƒˆ                          | èª¬æ˜                                                 |       |                                            |
| ---------------------------- | -------------------------------------------------- | ----- | ------------------------------------------ |
| `(state) =>`                 | ç¬¬ä¸€å¼•æ•°ã® `state` ã¯ã€ç¾åœ¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã® `state` ã‚’å—ã‘å–ã‚‹ã€‚           |       |                                            |
| `(...) => (...) => { ... }`  | **ã‚«ãƒªãƒ¼åŒ–**ã•ã‚ŒãŸé–¢æ•°ã€‚2ã¤ã®å¼•æ•°ã‚’åˆ†ã‘ã¦æ›¸ã„ã¦ã„ã‚‹ã€‚Vuex ã® getter ã§ã¯ã‚ˆãä½¿ã†ã€‚ |       |                                            |
| `state.operations.find(...)` | `operationId` ã«ä¸€è‡´ã™ã‚‹ä½œæˆ¦ã‚’ `operations` é…åˆ—ã‹ã‚‰æ¢ã™ã€‚        |       |                                            |
| `operation?.plans.find(...)` | `planId` ã«ä¸€è‡´ã™ã‚‹è¨ˆç”»ã‚’ãã®ä½œæˆ¦ã®ä¸­ã‹ã‚‰æ¢ã™ã€‚                       |       |                                            |
| \`plan?.measures             |                                                    | \[]\` | è¨ˆç”»ãŒè¦‹ã¤ã‹ã‚Œã°ãã® `measures` ã‚’è¿”ã—ã€ãªã‘ã‚Œã°ç©ºé…åˆ—ã‚’è¿”ã™ã€‚å®‰å…¨è¨­è¨ˆã€‚ |

> âœ… \*\*ã‚«ãƒªãƒ¼åŒ–é–¢æ•°ï¼ˆfunction curryingï¼‰\*\*ã¨ã¯ï¼š
> é–¢æ•°ã‚’åˆ†å‰²ã—ã¦ä½¿ã†æ§‹æ–‡ã€‚Vuex ã® getter ã§ã¯ `getter(state)(å¼•æ•°)` ã®ã‚ˆã†ã«ã€**å‹•çš„ã«å¼•æ•°ã‚’æ¸¡ã™ãŸã‚**ã«ã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚

---

## âœ… ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå´ï¼ˆOption APIï¼‰ã®æ§‹æ–‡è§£èª¬

```ts
computed: {
  measures(): Measure[] {
    return this.$store.getters['operation/getMeasuresByOperationAndPlan'](
      this.selectedOperationId,
      this.selectedPlanId
    );
  }
}
```

### â¬‡ åˆ†è§£ã—ã¦è§£èª¬

| ãƒ‘ãƒ¼ãƒˆ                                               | èª¬æ˜                                               |
| ------------------------------------------------- | ------------------------------------------------ |
| `this.$store.getters[...]`                        | Vuex ã‚¹ãƒˆã‚¢ã® getter ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã€‚                       |
| `'operation/getMeasuresByOperationAndPlan'`       | åå‰ç©ºé–“ã¤ãï¼ˆ`namespaced: true`ï¼‰ã®getterå‘¼ã³å‡ºã—ã€‚           |
| `(this.selectedOperationId, this.selectedPlanId)` | getter ã«å‹•çš„ã« ID ã‚’æ¸¡ã—ã¦ã€å¯¾å‡¦æ¡ˆãƒªã‚¹ãƒˆã‚’å–å¾—ã€‚                   |
| `computed`                                        | `measures` ã¯ computed ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ä½¿ãˆã‚‹ãŸã‚ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã‚‚ä½¿ãˆã‚‹ã€‚ |

---

## âœ… ã¾ã¨ã‚

| ç”¨èªãƒ»æ§‹æ–‡                          | æ„å‘³ãƒ»ãƒã‚¤ãƒ³ãƒˆ                        |       |                                  |
| ------------------------------ | ------------------------------ | ----- | -------------------------------- |
| `getter: (state) => (å¼•æ•°) => å€¤` | ã‚«ãƒªãƒ¼åŒ–ã•ã‚ŒãŸ getterã€‚å‹•çš„ã«çµã‚Šè¾¼ã‚€ç”¨é€”ã§ä½¿ã†ã€‚   |       |                                  |
| `state.xxx.find(...)`          | é…åˆ—ã‹ã‚‰æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹1ä»¶ã‚’å–å¾—ã€‚              |       |                                  |
| `?.`ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒã‚§ãƒ¼ãƒ³ï¼‰               | null/undefined ã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãšã«å‡¦ç†ç¶™ç¶šã€‚ |       |                                  |
| \`                             |                                | \[]\` | ä¸‡ä¸€ `undefined` ã®ã¨ãã«ç©ºé…åˆ—ã‚’è¿”ã—ã¦å®‰å…¨ã«ã™ã‚‹ã€‚ |
| `this.$store.getters[...]`     | Vue ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ getter ã‚’å‘¼ã³å‡ºã™æ–‡æ³•ã€‚  |       |                                  |

---

## âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã®ä½¿ç”¨ä¾‹ï¼ˆVuetifyï¼‰

```html
<v-list v-if="measures.length">
  <v-list-item
    v-for="(m, i) in measures"
    :key="i"
  >
    {{ m.measureId }}
  </v-list-item>
</v-list>
```

---

Vuex Getter ã®ã‚«ãƒªãƒ¼åŒ–ãªã©ãŒæ…£ã‚Œãªã„å ´åˆã¯ã€éã‚«ãƒªãƒ¼ç‰ˆã«ã‚‚æ›¸ãæ›ãˆã§ãã¾ã™ã€‚å¿…è¦ã§ã‚ã‚Œã°ãã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚èª¬æ˜å¯èƒ½ã§ã™ï¼
