ä»¥ä¸‹ã¯ã€Vuex + TypeScript + Option API ã‚’ä½¿ã£ã¦ã€æç¤ºã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’çŠ¶æ…‹ç®¡ç†ã™ã‚‹ãŸã‚ã®å®Ÿè£…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚

---

## âœ… 1. å‹å®šç¾©ï¼ˆ`types.ts` ãªã©ï¼‰

```ts
// store/types.ts
export interface Measure {
  measureId: string;
}

export interface Plan {
  planId: string;
  measures: Measure[];
}

export interface Operation {
  operationId: string;
  plans: Plan[];
}
```

---

## âœ… 2. Vuex ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®šç¾©ï¼ˆ`store/modules/operation.ts`ï¼‰

```ts
// store/modules/operation.ts
import { Module } from 'vuex';
import { Operation } from '../types';

export interface OperationState {
  operations: Operation[];
}

const state: OperationState = {
  operations: [],
};

const operationModule: Module<OperationState, any> = {
  namespaced: true,
  state,
  mutations: {
    setOperations(state, payload: Operation[]) {
      state.operations = payload;
    },
    addOperation(state, operation: Operation) {
      state.operations.push(operation);
    },
    clearOperations(state) {
      state.operations = [];
    },
  },
  actions: {
    initializeOperations({ commit }) {
      const data: Operation[] = [
        {
          operationId: 'OP001',
          plans: [
            {
              planId: 'PL001',
              measures: [
                { measureId: 'MS001' },
                { measureId: 'MS002' }
              ]
            },
            {
              planId: 'PL002',
              measures: [
                { measureId: 'MS003' }
              ]
            }
          ]
        },
        {
          operationId: 'OP002',
          plans: [
            {
              planId: 'PL003',
              measures: [
                { measureId: 'MS004' },
                { measureId: 'MS005' },
                { measureId: 'MS006' }
              ]
            }
          ]
        }
      ];
      commit('setOperations', data);
    }
  },
  getters: {
    getAllOperations: (state) => state.operations,
    getOperationById: (state) => (id: string) =>
      state.operations.find(op => op.operationId === id),
  }
};

export default operationModule;
```

---

## âœ… 3. ã‚¹ãƒˆã‚¢çµ±åˆï¼ˆ`store/index.ts`ï¼‰

```ts
// store/index.ts
import { createStore } from 'vuex';
import operationModule from './modules/operation';

export default createStore({
  modules: {
    operation: operationModule
  }
});
```

---

## âœ… 4. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã®ä½¿ç”¨ä¾‹ï¼ˆOption APIï¼‰

```ts
<script lang="ts">
import { defineComponent } from 'vue';
import { useStore } from 'vuex';
import { Operation } from '@/store/types';

export default defineComponent({
  name: 'OperationViewer',
  data() {
    return {
      selectedOperationId: 'OP001',
    };
  },
  computed: {
    operations(): Operation[] {
      return this.$store.getters['operation/getAllOperations'];
    },
    selectedOperation(): Operation | undefined {
      return this.$store.getters['operation/getOperationById'](this.selectedOperationId);
    }
  },
  mounted() {
    this.$store.dispatch('operation/initializeOperations');
  }
});
</script>
```

---

### ğŸ“ è£œè¶³

* **TypeScriptå¯¾å¿œ**: å‹ã®å®‰å…¨æ€§ã‚’ä¿ã¡ã¤ã¤Vuexã‚’æ§‹æˆã€‚
* **æ“ä½œæ‹¡å¼µ**: ä»Šå¾Œã€`addPlanToOperation` ã‚„ `addMeasureToPlan` ãªã©ã®ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§æ‹¡å¼µæ€§ã‚‚ç¢ºä¿ã€‚

å¿…è¦ãŒã‚ã‚Œã°ã€UIã¨ã®é€£æºéƒ¨åˆ†ã‚„ç·¨é›†æ©Ÿèƒ½ã®è¿½åŠ ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ææ¡ˆã§ãã¾ã™ã€‚


ã¯ã„ã€ã¾ã•ã«ãã®é€šã‚Šã§ã€**ä»Šå¾Œã®æ‹¡å¼µæ€§ã‚’è¦‹è¶Šã—ã¦**ä»¥ä¸‹ã®ã‚ˆã†ãª\*\*ãƒã‚¹ãƒˆæ§‹é€ ã«å¯¾å¿œã—ãŸæ“ä½œï¼ˆãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰\*\*ã‚’ Vuex ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ç¾å®Ÿçš„ãªã‚¢ãƒ—ãƒªã«é€²åŒ–ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## âœ… æ“ä½œæ‹¡å¼µã®ä¾‹ï¼šãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ 

### 1. `addPlanToOperation`ï¼ˆç‰¹å®šä½œæˆ¦ã«è¨ˆç”»ã‚’è¿½åŠ ï¼‰

```ts
mutations: {
  addPlanToOperation(state, payload: { operationId: string; plan: Plan }) {
    const op = state.operations.find(op => op.operationId === payload.operationId);
    if (op) {
      op.plans.push(payload.plan);
    }
  }
}
```

### 2. `addMeasureToPlan`ï¼ˆç‰¹å®šä½œæˆ¦ãƒ»è¨ˆç”»ã«å¯¾å‡¦æ¡ˆã‚’è¿½åŠ ï¼‰

```ts
mutations: {
  addMeasureToPlan(state, payload: {
    operationId: string;
    planId: string;
    measure: Measure;
  }) {
    const op = state.operations.find(op => op.operationId === payload.operationId);
    const plan = op?.plans.find(pl => pl.planId === payload.planId);
    if (plan) {
      plan.measures.push(payload.measure);
    }
  }
}
```

---

## âœ… ãã®ä»–ã®ä¾¿åˆ©ãªæ‹¡å¼µä¾‹

### âœ… `removePlanFromOperation`

```ts
mutations: {
  removePlanFromOperation(state, payload: { operationId: string; planId: string }) {
    const op = state.operations.find(op => op.operationId === payload.operationId);
    if (op) {
      op.plans = op.plans.filter(pl => pl.planId !== payload.planId);
    }
  }
}
```

### âœ… `updateMeasure`ï¼ˆå¯¾å‡¦æ¡ˆã®ç·¨é›†ï¼‰

```ts
mutations: {
  updateMeasure(state, payload: {
    operationId: string;
    planId: string;
    measureId: string;
    newMeasure: Measure;
  }) {
    const op = state.operations.find(op => op.operationId === payload.operationId);
    const plan = op?.plans.find(pl => pl.planId === payload.planId);
    const measureIndex = plan?.measures.findIndex(ms => ms.measureId === payload.measureId);
    if (measureIndex !== undefined && measureIndex >= 0 && plan) {
      plan.measures[measureIndex] = payload.newMeasure;
    }
  }
}
```

---

## âœ… åˆ©ç”¨ä¾‹ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³çµŒç”±ã§å‘¼ã³å‡ºã—ï¼‰

```ts
actions: {
  addNewPlanToOperation({ commit }, payload: { operationId: string; plan: Plan }) {
    commit('addPlanToOperation', payload);
  },
  appendMeasure({ commit }, payload: { operationId: string; planId: string; measure: Measure }) {
    commit('addMeasureToPlan', payload);
  }
}
```

---

## ğŸ§© UIä¾‹ï¼ˆåˆ©ç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰

* ä½œæˆ¦è©³ç´°ç”»é¢ã§ã€Œï¼‹è¨ˆç”»è¿½åŠ ã€ãƒœã‚¿ãƒ³ â†’ Dialogã§æ–°è¦å…¥åŠ› â†’ `dispatch('addNewPlanToOperation', ...)`
* è¨ˆç”»ä¸€è¦§ã§ã€Œï¼‹å¯¾å‡¦æ¡ˆè¿½åŠ ã€ â†’ ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã§é¸æŠ â†’ `dispatch('appendMeasure', ...)`

---

## ğŸ’¡æ‹¡å¼µæ€§ã®è€ƒãˆæ–¹

* éšå±¤æ§‹é€ ã«å¿œã˜ã¦ã€`operationId â†’ planId â†’ measureId` ã® **ã‚­ãƒ¼ã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**ãŒã§ãã‚‹ã¨ã€è‡ªç”±åº¦ãŒéå¸¸ã«é«˜ããªã‚Šã¾ã™ã€‚
* UIå´ã§ã‚‚å†å¸°çš„è¡¨ç¤ºï¼ˆTreeæ§‹é€ ã‚„v-forãƒã‚¹ãƒˆï¼‰ã«å¯¾å¿œã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

---

ã”å¸Œæœ›ã§ã‚ã‚Œã°ã€å®Ÿéš›ã®ç”»é¢è¨­è¨ˆã‚„ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ã¨ã®é€£æºéƒ¨åˆ†ã‚‚ææ¡ˆå¯èƒ½ã§ã™ã€‚æ¬¡ã«è¿½åŠ ã—ãŸã„æ“ä½œãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„ï¼
