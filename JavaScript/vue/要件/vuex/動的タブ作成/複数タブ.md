ã”è¦æœ›ã¯ï¼š

1. Vuex ã‚¹ãƒˆã‚¢ã«ã€Œ**ã‚¿ãƒ–ã”ã¨ã®ãƒšãƒ¼ã‚¸æƒ…å ±ï¼ˆï¼å¯¾å¿œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰**ã€ã‚’ä¿æŒã—ãŸã„
2. ãã‚Œã«å¯¾å¿œã—ã¦ã€Œ**ã‚¿ãƒ–ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**ã€ã‚’å‹•çš„ã«å®šç¾©ãƒ»è¡¨ç¤ºã—ãŸã„

ã¨ã„ã†ç†è§£ã§åˆã£ã¦ã„ã¾ã™ã€‚

---

## âœ… çµè«–ï¼šVuex ã§ã€Œè¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæƒ…å ±ã€ã‚’ç®¡ç†ã—ã€`<component :is="...">` ã§å‹•çš„è¡¨ç¤ºã—ã¾ã™ã€‚

---

## â‘  Vuex ã‚¹ãƒˆã‚¢å®šç¾©ï¼ˆ`store/modules/tabModule.ts`ï¼‰

```ts
// store/modules/tabModule.ts
import { Module } from 'vuex'

export interface TabData {
  id: string
  title: string
  componentName: string // â† ã“ã“ã«ç™»éŒ²ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåï¼ˆå¾Œã§ä½¿ã†ï¼‰
}

interface TabState {
  tabs: TabData[]
  activeTab: string
}

export const tabModule: Module<TabState, any> = {
  namespaced: true,
  state: (): TabState => ({
    tabs: [
      { id: 'tab1', title: 'ãƒ•ã‚©ãƒ¼ãƒ A', componentName: 'FormA' },
      { id: 'tab2', title: 'è¡¨B', componentName: 'TableB' }
    ],
    activeTab: 'tab1'
  }),
  mutations: {
    ADD_TAB(state, payload: { title: string; componentName: string }) {
      const id = `tab${state.tabs.length + 1}`
      state.tabs.push({ id, title: payload.title, componentName: payload.componentName })
      state.activeTab = id
    },
    SET_ACTIVE_TAB(state, tabId: string) {
      state.activeTab = tabId
    }
  }
}
```

---

## â‘¡ ãƒšãƒ¼ã‚¸ç”¨ã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆä¾‹ï¼‰

### `components/FormA.vue`

```vue
<template><div>ã“ã‚Œã¯ãƒ•ã‚©ãƒ¼ãƒ Aã®ãƒšãƒ¼ã‚¸</div></template>
<script setup lang="ts"></script>
```

### `components/TableB.vue`

```vue
<template><div>ã“ã‚Œã¯è¡¨Bã®ãƒšãƒ¼ã‚¸</div></template>
<script setup lang="ts"></script>
```

---

## â‘¢ ã‚¿ãƒ–è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆä¾‹ï¼š`DynamicTabs.vue`ï¼‰

```vue
<template>
  <div>
    <!-- ã‚¿ãƒ–ãƒ˜ãƒƒãƒ€ -->
    <div style="display: flex;">
      <div
        v-for="tab in tabs"
        :key="tab.id"
        :style="{ padding: '8px', cursor: 'pointer', backgroundColor: tab.id === activeTab ? '#ccc' : '#eee' }"
        @click="setActive(tab.id)"
      >
        {{ tab.title }}
      </div>
      <div style="padding: 8px; cursor: pointer;" @click="addTab">ï¼‹</div>
    </div>

    <!-- ã‚¿ãƒ–ãƒšãƒ¼ã‚¸ -->
    <component
      :is="currentComponent"
      style="margin-top: 20px; border: 1px solid #ddd; padding: 10px;"
    />
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useStore } from 'vuex'

import FormA from './FormA.vue'
import TableB from './TableB.vue'

const store = useStore()
const tabs = computed(() => store.state.tabModule.tabs)
const activeTab = computed(() => store.state.tabModule.activeTab)

const componentsMap = {
  FormA,
  TableB
}

const currentComponent = computed(() => {
  const active = tabs.value.find(t => t.id === activeTab.value)
  return active ? componentsMap[active.componentName as keyof typeof componentsMap] : null
})

const setActive = (id: string) => {
  store.commit('tabModule/SET_ACTIVE_TAB', id)
}

const addTab = () => {
  store.commit('tabModule/ADD_TAB', { title: 'æ–°ã‚¿ãƒ–', componentName: 'FormA' }) // è¿½åŠ ã™ã‚‹å‹ã«åˆã‚ã›ã‚‹
}
</script>
```

---

## âœ… ãƒã‚¤ãƒ³ãƒˆ

| è¦ç´                     | å†…å®¹                                   |
| --------------------- | ------------------------------------ |
| `component :is="..."` | æŒ‡å®šåã® Vue ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‹•çš„ã«è¡¨ç¤º               |
| `componentName`       | Vuex ã§ä¿æŒã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è­˜åˆ¥å­                |
| `componentsMap`       | import ã—ãŸ Vue ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç´ä»˜ã‘ã‚‹ãŸã‚ã®è¾æ›¸         |
| è¤‡æ•°ãƒšãƒ¼ã‚¸å¯¾å¿œ               | ãã‚Œãã‚Œã®ã‚¿ãƒ–ã« `componentName` ã‚’å¤‰ãˆã‚‹ã ã‘ã§å®Ÿç¾å¯èƒ½ |

---

### ğŸ‘€ è¿½åŠ å¯èƒ½ãªã‚¿ãƒ–ãƒšãƒ¼ã‚¸ãŒè¤‡æ•°ã‚ã‚‹å ´åˆ

`FormA`, `TableB`, `ChartC`, `EditorD` ãªã© `componentsMap` ã«è¿½åŠ ã—ã¦ãŠã‘ã°ã€ã©ã®ãƒšãƒ¼ã‚¸ã§ã‚‚å·®ã—æ›¿ãˆå¯èƒ½ã§ã™ã€‚

---

å¿…è¦ã§ã‚ã‚Œã°ã€æ¬¡ã¯ã€Œã‚¿ãƒ–ã®å‰Šé™¤ã€ã€Œã‚¿ãƒ–ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›†ã€ã€Œå‹•çš„ import ã«ã‚ˆã‚‹è»½é‡åŒ–ã€ãªã©ã‚‚å¯¾å¿œå¯èƒ½ã§ã™ã€‚ã©ã“ã¾ã§é€²ã‚ã¾ã™ã‹ï¼Ÿ



äº†è§£ã—ã¾ã—ãŸï¼
ã“ã“ã§ã¯ Vuex + å‹•çš„ã‚¿ãƒ–æ§‹æˆã«ã€Œ**ã‚¿ãƒ–å‰Šé™¤æ©Ÿèƒ½**ã€ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## âœ… æ©Ÿèƒ½ä»•æ§˜ï¼šã‚¿ãƒ–ã®å‰Šé™¤

| é …ç›®   | å†…å®¹                                   |
| ---- | ------------------------------------ |
| UI   | å„ã‚¿ãƒ–ã« âœ• ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºï¼ˆã‚¯ãƒªãƒƒã‚¯ã§ã‚¿ãƒ–å‰Šé™¤ï¼‰             |
| ãƒ­ã‚¸ãƒƒã‚¯ | Vuex ã‹ã‚‰å¯¾è±¡ã‚¿ãƒ–ã‚’å‰Šé™¤ã€å¿…è¦ãªã‚‰ `activeTab` ã®å†è¨­å®š |
| åˆ¶é™   | æœ€ä½1ã¤ã®ã‚¿ãƒ–ã¯æ®‹ã™ï¼ã¾ãŸã¯ç©ºè¨±å®¹ãªã©ä»»æ„åˆ¶å¾¡å¯èƒ½            |

---

## ğŸ§© Vuex ã‚¹ãƒˆã‚¢ä¿®æ­£ï¼ˆ`tabModule.ts`ï¼‰

```ts
mutations: {
  // ...æ—¢å­˜ã®ADD_TAB, SET_ACTIVE_TAB...

  REMOVE_TAB(state, id: string) {
    const index = state.tabs.findIndex(t => t.id === id)
    if (index === -1) return

    state.tabs.splice(index, 1)

    // å‰Šé™¤ã•ã‚ŒãŸã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã ã£ãŸå ´åˆã¯å‰ã®ã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
    if (state.activeTab === id) {
      const fallback = state.tabs[index - 1] || state.tabs[0]
      state.activeTab = fallback ? fallback.id : ''
    }
  }
}
```

---

## ğŸ§© UIä¿®æ­£ï¼ˆ`DynamicTabs.vue`ï¼‰

```vue
<!-- ã‚¿ãƒ–ä¸€è¦§ -->
<div style="display: flex;">
  <div
    v-for="tab in tabs"
    :key="tab.id"
    :style="{ padding: '8px', cursor: 'pointer', backgroundColor: tab.id === activeTab ? '#ccc' : '#eee', marginRight: '4px', display: 'flex', alignItems: 'center' }"
  >
    <span @click="setActive(tab.id)" style="margin-right: 4px;">{{ tab.title }}</span>
    <span @click="removeTab(tab.id)" style="color: red; cursor: pointer;">âœ•</span>
  </div>
  <div style="padding: 8px; cursor: pointer;" @click="addTab">ï¼‹</div>
</div>
```

---

## ğŸ§© ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ ï¼ˆ`<script setup>`ï¼‰

```ts
const removeTab = (id: string) => {
  store.commit('tabModule/REMOVE_TAB', id)
}
```

---

## âœ… çµæœã‚¤ãƒ¡ãƒ¼ã‚¸

* ã‚¿ãƒ–ã«ã€Œâœ•ã€ãŒä»˜ãã€ã‚¯ãƒªãƒƒã‚¯ã§ãã®ã‚¿ãƒ–ã ã‘å‰Šé™¤ã•ã‚Œã‚‹
* å‰Šé™¤å¯¾è±¡ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã ã£ãŸå ´åˆã¯ã€**å‰ã®ã‚¿ãƒ–ã«è‡ªå‹•ãƒ•ã‚©ãƒ¼ã‚«ã‚¹**

---

## ğŸ’¡ ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ å¯èƒ½

| æ©Ÿèƒ½        | èª¬æ˜                                       |
| --------- | ---------------------------------------- |
| å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° | `confirm()` ã§ã€Œæœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã€ã‚’å‡ºã™             |
| æœ€ä½1ã‚¿ãƒ–åˆ¶é™   | `if (tabs.length <= 1) return;` ãªã©ã§ã‚¬ãƒ¼ãƒ‰å¯èƒ½ |
| ç·¨é›†ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ   | ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ãªã©ä½µç”¨ã™ã‚‹ãªã‚‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼æ–¹å¼ã‚‚å¯èƒ½            |

---

ã“ã®æ©Ÿèƒ½ã§ã€Œå‹•çš„è¿½åŠ ã€ã€Œå‰Šé™¤ã€ã€ŒçŠ¶æ…‹ä¿æŒã€ã€Œå‹•çš„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¡¨ç¤ºã€ãŒã™ã¹ã¦æƒã„ã¾ã™ã€‚
æ¬¡ã«ã€Œã‚¿ã‚¤ãƒˆãƒ«ã®ç·¨é›†ã€ã‚‚å¿…è¦ã§ã™ã‹ï¼Ÿ
äº†è§£ã—ã¾ã—ãŸã€‚
ç›®çš„ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã­ï¼š

---

## ğŸ¯ ç›®çš„

**çŠ¶æ…‹ç®¡ç†ãƒšãƒ¼ã‚¸ï¼ˆï¼Vuexã®ã‚¹ãƒˆã‚¢ï¼‰ã«ã‚ã‚‰ã‹ã˜ã‚ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿**ã‚’å…ƒã«ã€
**ãƒšãƒ¼ã‚¸åˆæœŸè¡¨ç¤ºæ™‚ã«ã‚¿ãƒ–ã‚’è‡ªå‹•ç”Ÿæˆã—ã¦è¡¨ç¤ºã—ãŸã„ã€‚**

---

## âœ… å¯¾å¿œæ–¹é‡ï¼ˆVuexã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å‰æï¼‰

| å‡¦ç†ã‚¿ã‚¤ãƒŸãƒ³ã‚°     | æ–¹æ³•                                                    |
| ----------- | ----------------------------------------------------- |
| ãƒšãƒ¼ã‚¸åˆæœŸè¡¨ç¤ºæ™‚    | `onMounted()` ã§ Vuex ã‚¹ãƒˆã‚¢ã‚’èª­ã¿å–ã‚Šã€å¿…è¦ã§ã‚ã‚Œã°æ•´å½¢ã—ã¦ `ADD_TAB` ã™ã‚‹ |
| åˆæœŸã‚¿ãƒ–ãƒ‡ãƒ¼ã‚¿ã®å®šç¾©  | ã‚¹ãƒˆã‚¢ã® `state.savedPageData` ã®ã‚ˆã†ãªé …ç›®ã‹ã‚‰ã‚¿ãƒ–ã‚’ç”Ÿæˆ              |
| è¿½åŠ æ¸ˆã¿ã‚¿ãƒ–ã®é‡è¤‡é˜²æ­¢ | `id` ã‚„ `title` ã§é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆã¾ãŸã¯ä¸€æ‹¬åˆæœŸåŒ–ï¼‰                      |

---

## ğŸ§© Vuex ã‚¹ãƒˆã‚¢ä¾‹ï¼ˆ`tabModule.ts`ï¼‰

```ts
interface PageEntity {
  id: string
  title: string
  componentName: string
}

interface TabState {
  tabs: PageEntity[]
  activeTab: string
  savedPages: PageEntity[] // â† ã“ã‚ŒãŒçŠ¶æ…‹ç®¡ç†ãƒšãƒ¼ã‚¸ã‹ã‚‰å–å¾—ã•ã‚Œã‚‹åˆæœŸãƒ‡ãƒ¼ã‚¿
}

export const tabModule: Module<TabState, any> = {
  namespaced: true,
  state: (): TabState => ({
    tabs: [],
    activeTab: '',
    savedPages: [ // â† ä»®ã«ã“ã“ã«äº‹å‰ä¿æŒã•ã‚Œã¦ã„ã‚‹ã¨ä»®å®š
      { id: 'tab1', title: 'ãƒ•ã‚©ãƒ¼ãƒ A', componentName: 'FormA' },
      { id: 'tab2', title: 'è¡¨B', componentName: 'TableB' }
    ]
  }),
  mutations: {
    SET_TABS(state, tabs: PageEntity[]) {
      state.tabs = tabs
      if (tabs.length > 0) state.activeTab = tabs[0].id
    },
    // ...ADD_TAB, REMOVE_TAB ãªã©
  }
}
```

---

## ğŸ§© `DynamicTabs.vue` ã§åˆæœŸèª­ã¿è¾¼ã¿å‡¦ç†

```vue
<script setup lang="ts">
import { onMounted, computed } from 'vue'
import { useStore } from 'vuex'
import FormA from './FormA.vue'
import TableB from './TableB.vue'

const store = useStore()
const tabs = computed(() => store.state.tabModule.tabs)

onMounted(() => {
  if (tabs.value.length === 0) {
    const saved = store.state.tabModule.savedPages
    store.commit('tabModule/SET_TABS', saved)
  }
})
</script>
```

---

## âœ… åˆæœŸèª­ã¿è¾¼ã¿ã§ã®è¡¨ç¤ºå‹•ä½œ

* `savedPages` ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ã€ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã« `tabs` ã«ã‚»ãƒƒãƒˆ
* å„ã‚¿ãƒ–ã¯ `componentName` ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€`<component :is="...">` ã§ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
* ã™ã§ã«ã‚¿ãƒ–ãŒå­˜åœ¨ã™ã‚‹å ´åˆï¼ˆä¾‹ï¼šç”»é¢é·ç§»æˆ»ã‚Šæ™‚ï¼‰ã¯ `SET_TABS` ã—ãªã„ã®ã§å®‰å…¨

---

## ğŸ’¡ ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼·åŒ–

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³             | èª¬æ˜                                                  |
| ----------------- | --------------------------------------------------- |
| åˆæœŸã‚¿ãƒ–ã« `props` ã‚’æ¸¡ã™ | `componentName` ã ã‘ã§ãªã `props` ã‚’æŒãŸã›ã‚Œã° OK             |
| éåŒæœŸå–å¾—             | `savedPages` ã‚’ API ã‹ã‚‰å–å¾—ã™ã‚‹ãªã‚‰ `actions` ã¨ `await` ã‚’æ´»ç”¨ |
| æ°¸ç¶šç®¡ç†              | å¿…è¦ãŒã‚ã‚Œã° `sessionStorage` ã‚„ `keep-alive` ã‚‚ä½µç”¨å¯èƒ½        |

---

### âœ… å®Ÿè£…ã®å…¨ä½“æ§‹æˆãŒæ•´ç†ã•ã‚Œã¾ã—ãŸï¼š

1. `savedPages` ã«çŠ¶æ…‹ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚„ä»–ãƒšãƒ¼ã‚¸ç”±æ¥ï¼‰
2. åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã« `tabs` ã«å±•é–‹ã—ã€è¡¨ç¤º
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§ã‚¿ãƒ–è¿½åŠ ãƒ»å‰Šé™¤ãŒå¯èƒ½

---

å¿…è¦ã§ã‚ã‚Œã°ã€ã€ŒAPIã‹ã‚‰å–å¾—ã—ã¦åˆæœŸåŒ–ã€ã‚„ã€Œã‚¿ãƒ–å¾©å…ƒæ©Ÿèƒ½ã€ã‚‚å¯¾å¿œã§ãã¾ã™ã€‚ç¶šã‘ã¾ã™ã‹ï¼Ÿ
